<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>前端模块化 | whilter的个人博客</title>
    <meta name="description" content="my personal blog">
    <link rel="stylesheet" href="/css/iconfont.css">
    
    <link rel="preload" href="/assets/css/0.styles.383c8f51.css" as="style"><link rel="preload" href="/assets/js/app.87375f03.js" as="script"><link rel="preload" href="/assets/js/3.87a16814.js" as="script"><link rel="preload" href="/assets/js/13.8ebaa0bd.js" as="script"><link rel="prefetch" href="/assets/js/10.d7f69cd9.js"><link rel="prefetch" href="/assets/js/11.b3dcf3c7.js"><link rel="prefetch" href="/assets/js/12.c96cfe7b.js"><link rel="prefetch" href="/assets/js/14.89a1f658.js"><link rel="prefetch" href="/assets/js/15.7c63147d.js"><link rel="prefetch" href="/assets/js/16.22291763.js"><link rel="prefetch" href="/assets/js/2.a0a46997.js"><link rel="prefetch" href="/assets/js/4.d240423a.js"><link rel="prefetch" href="/assets/js/5.476423f5.js"><link rel="prefetch" href="/assets/js/6.2acd4f1a.js"><link rel="prefetch" href="/assets/js/7.09fa1837.js"><link rel="prefetch" href="/assets/js/8.e4d00460.js"><link rel="prefetch" href="/assets/js/9.cf2c8318.js">
    <link rel="stylesheet" href="/assets/css/0.styles.383c8f51.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="main-layout" data-v-425c8d7b><div id="content" data-v-425c8d7b><div class="sidebar content-side" data-v-425c8d7b><div class="return-home" data-v-425c8d7b><span class="blog-img" data-v-425c8d7b></span>whilter的个人博客</div> <ul class="headers-list" data-v-425c8d7b><h3 data-v-425c8d7b>前端模块化</h3> <li title="JS模块化的源起" style="padding-left:0rem;" data-v-425c8d7b>
          JS模块化的源起
        </li><li title="刀耕火种的原始年代" style="padding-left:1.2rem;" data-v-425c8d7b>
          刀耕火种的原始年代
        </li><li title="初步模块化" style="padding-left:1.2rem;" data-v-425c8d7b>
          初步模块化
        </li><li title="nodeJS带来的模块化解决方案--CommonJS" style="padding-left:1.2rem;" data-v-425c8d7b>
          nodeJS带来的模块化解决方案--CommonJS
        </li><li title="为浏览器适配的模块异步加载方案" style="padding-left:1.2rem;" data-v-425c8d7b>
          为浏览器适配的模块异步加载方案
        </li><li title="ES6标准的模块化解决方案" style="padding-left:1.2rem;" data-v-425c8d7b>
          ES6标准的模块化解决方案
        </li></ul></div> <div class="container" style="overflow: auto" data-v-425c8d7b><div class="page-content" data-v-425c8d7b><div class="content__default" data-v-425c8d7b><h1 id="前端模块化"><a href="#前端模块化" class="header-anchor">#</a> 前端模块化</h1> <h2 id="js模块化的源起"><a href="#js模块化的源起" class="header-anchor">#</a> JS模块化的源起</h2> <h3 id="刀耕火种的原始年代"><a href="#刀耕火种的原始年代" class="header-anchor">#</a> 刀耕火种的原始年代</h3> <p>在早期，前端还处于页面仔的时代，JavaScript只是作为一个简单的脚本语言来使用，做一些表单验证，简单的动画实现，以及部分信息提示等操作，代码也相对简单，直接写在script标签内，复杂一点的单独写在js文件里，由script引入，整个网站js代码量也不过千行，开发维护都很简单。</p> <p>这个时候的js定位是一门辅助性的嵌入式脚本语言，不需要大型代码组织，甚至没有类的概念，更不用说模块化解决方案。早期的代码组织，都是通过简单的函数封装声明，或者定义对象的方式来实现</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">function</span> <span class="token function">printError</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">var</span> modelA <span class="token operator">=</span> <span class="token punctuation">{</span>
    a<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    b<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token function-variable function">add</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>b
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'submit'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onClick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> form <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'form'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>form<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">printError</span><span class="token punctuation">(</span><span class="token string">'未找到表单，请刷新重试'</span><span class="token punctuation">)</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="初步模块化"><a href="#初步模块化" class="header-anchor">#</a> 初步模块化</h3> <p>后来随着ajax的出现，页面拥有了与服务器异步交互数据的能力，js语言能做的事情开始变多，出现了以jQuery为代表的一系列框架和类库，以及相关生态工具，前端开发开始变得较为复杂，代码量也大幅增加，但是与此同时也暴露出了很多问题。</p> <div class="custom-block warning"><p class="custom-block-title">常见问题</p> <ol><li>不同js文件之间依赖问题（如bootstrap依赖jQuery），大量文件之间互相依赖，其加载顺序需要人为控制，增加了维护成本和出错概率</li> <li>全局变量污染，多人协同开发时，为了避免变量污染，需要增加大量沟通成本，后期也难以维护</li> <li>单个js文件代码量过于庞大，拆分困难</li> <li>公用代码提取与引入带来的命名复杂，引入第三方库时变量冲突等</li></ol></div> <p>为了解决以上的问题，开始陆续出现很多解决方案，有利用闭包原理封装隐藏变量，暴露出部分api供外部调用，如</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function-variable function">moduleA</span> <span class="token operator">=</span> <span class="token keyword">function</span>（） <span class="token punctuation">{</span>
   <span class="token keyword">var</span> a<span class="token punctuation">,</span> b
   <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">add</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
         <span class="token keyword">return</span> a <span class="token operator">+</span> b <span class="token operator">+</span> c
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>这种方法将变量和实现细节封装在function作用域里，对外隐藏，达到了封装目的，但对于实际开发还是不够方便，而且模块名也容易引起全局变量污染。</p> <p>还有借鉴其他语言，如Java，使用命名空间</p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span>tools<span class="token punctuation">.</span>moduleA<span class="token punctuation">.</span><span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> app<span class="token punctuation">.</span>tools<span class="token punctuation">.</span>moduleA<span class="token punctuation">.</span>a <span class="token operator">+</span> c
<span class="token punctuation">}</span>
</code></pre></div><p>很显然，这种方法过于冗余，维护也很不方便</p> <h3 id="nodejs带来的模块化解决方案-commonjs"><a href="#nodejs带来的模块化解决方案-commonjs" class="header-anchor">#</a> nodeJS带来的模块化解决方案--CommonJS</h3> <p>随着nodeJS的横空出世，js语言突破了浏览器的限制，拥有了如其他后端语言--PHP和Java一样的读写文件、和操作系统底层交互的能力，使得js这门语言进一步拥有了无限的可能。</p> <p>同时由于服务端编程的复杂性，模块化成为必不可少的功能，由此带来了第一个流行的js模块化解决方案，CommonJS规范</p> <p><strong>CommonJS概述</strong></p> <div class="custom-block tip"><p class="custom-block-title">关键字</p> <p><em><strong>module</strong></em>     （一个对象，代表当前模块）</p> <p><em><strong>module.exports</strong></em>     （module对象的一个属性，代表对外接口，加载某个模块，其实是加载该模块的module.exports属性）</p> <p><em><strong>exports</strong></em>      （Node为每个模块提供的一个变量，指向module.exports，<strong>不要直接对其赋值</strong>，会改变指向引起错误，推荐使用module.exports）</p> <p><em><strong>require</strong></em>    （Node内置的命令，用于加载模块）</p></div> <p>CommonJS规定一个文件就是一个模块，模块拥有各自的作用域，其内定义的变量、函数、类都是私有的，对其他文件不可见（除非定义为global对象的属性，不推荐这么干），向外暴露属性和方法时，使用module.exports或者exports属性（推荐使用module.exports命令），加载时使用require命令，加载时默认是js文件，可省略.js后缀</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// a.js</span>
<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token number">2</span>
module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span><span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b
<span class="token punctuation">}</span>

<span class="token comment">// c.js</span>
<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">3</span>
<span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token number">4</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b
<span class="token punctuation">}</span>
<span class="token comment">// 错误写法，不能直接赋值给exports对象，会改变其指向，导致报错</span>
<span class="token comment">/** exports = () =&gt; {
  return a + b
}
*/</span>

<span class="token comment">// b.js</span>
<span class="token keyword">const</span> add <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'a.js'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>add <span class="token comment">// 加载add函数</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>              <span class="token comment">// 3</span>

<span class="token comment">// b.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>add<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'a.js'</span><span class="token punctuation">)</span>   <span class="token comment">// ES6写法</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// b.js</span>
<span class="token keyword">const</span> moduleA <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>    <span class="token comment">// 加载exports，exports为一个对象 {add: () =&gt; {}}</span>
<span class="token keyword">const</span> moduleC <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">)</span>    <span class="token comment">// 加载exports，此时exports为一个函数</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>moduleA<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token comment">// 3</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">moduleC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>          <span class="token comment">// 7</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>moduleA<span class="token punctuation">.</span>a<span class="token punctuation">)</span>          <span class="token comment">// undefined， 内部非对外暴露变量，对外不可见</span>

</code></pre></div><p><strong>require命令</strong></p> <p>require命令的基本功能是，读取并执行一个js文件，然后返回该模块指定的exports对象，若没有找到该模块，则报错。</p> <p>require参数可以是绝对路径，也可以是相对路径，若直接填文件名，则表示加载的是一个默认提供的核心模块（位于Node的系统安装目录中），或者一个位于各级node_modules目录的已安装模块（全局安装或局部安装）。若指定的文件未找到，Node会尝试为文件名添加.js、.json、.node后缀，再去搜索。</p> <div class="custom-block warning"><p class="custom-block-title">说明</p> <ol><li>CommonJS加载是同步加载机制，所有模块在加载完成后才能继续执行后续代码</li> <li>加载模块时，输入的是被输出值的拷贝，也就是说一旦输出一个值，其模块内部的变化就不再影响这个值</li> <li>Node加载模块后会有缓存机制，以后再加载该模块，直接从缓存取出该模块的module.exports属性</li></ol></div> <p>详细的加载机制以及编译过程请参考阮一峰老师编写的<a href="http://javascript.ruanyifeng.com/nodejs/module.html#" target="_blank" rel="noopener noreferrer">CommonJS规范<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="为浏览器适配的模块异步加载方案"><a href="#为浏览器适配的模块异步加载方案" class="header-anchor">#</a> 为浏览器适配的模块异步加载方案</h3> <p>由上文知道，CommonJS规范是同步加载机制，模块加载完成才能继续执行代码。而受限于浏览器下的网络请求环境，若等待所有依赖模块加载完成，则需要等待很长时间，即使这个模块暂时未被使用，也需要预先下载完成，造成不必要的等待时间，同时会阻塞页面渲染，出现页面假死状态。用户体验不友好。因此出现了一些异步模块加载的解决方案</p> <h4 id="amd-requirejs"><a href="#amd-requirejs" class="header-anchor">#</a> AMD &amp; RequireJS</h4> <p>AMD（Asynchronous Module Definition）异步加载模块。AMD标准规定，用define来定义模块，用require来加载模块。RequireJS就是其规范的一种实现。项目中我未使用过，可参考阮一峰的<a href="http://www.ruanyifeng.com/blog/2012/11/require_js.html" target="_blank" rel="noopener noreferrer">RequireJS的用法<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h4 id="cmd-sea-js"><a href="#cmd-sea-js" class="header-anchor">#</a> CMD &amp; sea.js</h4> <p>CMD（Common Module Definition）通用模块定义。这是SeaJS 在推广过程中对模块定义的规范化产出，具体参考<a href="https://github.com/seajs/seajs/issues/242" target="_blank" rel="noopener noreferrer">CMD模块定义规范<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>关于这两个的区别，可参考玉伯在知乎的一个回答<a href="https://www.zhihu.com/question/20351507" target="_blank" rel="noopener noreferrer">AMD和CMD的区别<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="es6标准的模块化解决方案"><a href="#es6标准的模块化解决方案" class="header-anchor">#</a> ES6标准的模块化解决方案</h3> <p>ECMAScript 6.0是JavaScript语言的下一代标准，已经在2015年6月正式发布了。它的目标，是使得JavaScript语言可以用来编写复杂的大型应用程序，成为企业级开发语言。ES6提供了一个标准的模块化解决方案。</p> <p>ES6 模块的设计思想，是尽量的静态化，使得编译时就能确定模块的依赖关系，以及输入和输出的变量。CommonJS 和 AMD 模块，都只能在运行时确定这些东西。</p></div></div></div></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.87375f03.js" defer></script><script src="/assets/js/3.87a16814.js" defer></script><script src="/assets/js/13.8ebaa0bd.js" defer></script>
  </body>
</html>
